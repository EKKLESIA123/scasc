<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Skin Analysis Demo</title>
    <script defer src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/dist/face-api.min.js"></script>
    <style>
        video { border: 1px solid black; }
        canvas { position: absolute; top: 0; left: 0; }
    </style>
</head>
<body>
    <h1>Skin Analysis Demo</h1>
    <video id="video" width="640" height="480" autoplay muted></video>
    <canvas id="overlay" width="640" height="480"></canvas>
    <p id="result"></p>

    <script>
        const video = document.getElementById('video');
        const resultText = document.getElementById('result');

        // เปิดกล้อง
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => { video.srcObject = stream })
            .catch(err => console.error(err));

        async function loadModels() {
            await faceapi.nets.tinyFaceDetector.loadFromUri('https://cdn.jsdelivr.net/npm/@vladmandic/face-api/model/');
            startDetection();
        }

        async function startDetection() {
            const canvas = document.getElementById('overlay');
            const displaySize = { width: video.width, height: video.height };
            faceapi.matchDimensions(canvas, displaySize);

            setInterval(async () => {
                const detections = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions());
                const resized = faceapi.resizeResults(detections, displaySize);

                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                resized.forEach(det => {
                    const box = det.box;
                    ctx.strokeStyle = 'green';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(box.x, box.y, box.width, box.height);

                    // Rule-Based Skin Analysis (ง่าย ๆ)
                    const brightness = box.width + box.height; // แค่ตัวอย่าง
                    let skinType = 'ผิวปกติ';
                    if (brightness > 300) skinType = 'ผิวมัน';
                    else if (brightness < 250) skinType = 'ผิวแห้ง';

                    resultText.innerText = `Skin Type: ${skinType}`;
                });
            }, 500);
        }

        loadModels();
    </script>
</body>
</html>
